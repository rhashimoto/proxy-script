{"version":3,"file":"proxy-script.js","sources":["../../src/Transpiler.js","../../src/Runtime.js"],"sourcesContent":["const NO_WRAP_NEEDED = new Set([\n  // These types cannot be wrapped with a Proxy. This is only an\n  // optimization as the wrapper checks for this.\n  'BigIntLiteral',\n  'BooleanLiteral',\n  'DecimalLiteral',\n  'NullLiteral',\n  'NumericLiteral',\n  'StringLiteral',\n  'TemplateLiteral',\n\n  // These types return one of their sub-expressions. This is only\n  // an optimization as wrapping a proxy always returns the original\n  // proxy.\n  'ConditionalExpression',\n  'LogicalExpression',\n  'ParenthesizedExpression',\n  'SequenceExpression',\n\n  // `super` is a keyword and isn't valid inside a wrapper. This seems\n  // dangerous because of the possibility of subclassing Function. However,\n  // in `class Foo extends Bar...`, `Bar` will be wrapped and so the\n  // constructor call will be whitelist checked.\n  'Super'\n]);\n\nlet Babel;\n\nfunction plugin({ types, template }, options) {\n  const bindings = Object.assign({\n    wrap: '_w' + createRandomString(),\n    call: '_c' + createRandomString()\n  }, options.bindings);\n \n  // All object expressions are wrapped by a Proxy to prevent them from\n  // changing global state. Give the wrapping function a random alias so\n  // it can't be shadowed.\n  const wrap = template.expression(`${bindings.wrap}(NODE)`, {\n    placeholderPattern: /^NODE$/\n  });\n\n  // Use a helper function for method calls, both for proper binding and\n  // to handle Function.prototype.{call, apply}.\n  const call = template.expression(`${bindings.call}(OBJECT, PROPERTY, ARGS)`, {\n    placeholderPattern: /^(OBJECT|PROPERTY|ARGS)$/\n   });\n\n  // Wrap the entire script in an Immediately Invoked Function Expression\n  // to enable await and establish the wrapping function alias.\n  const iife = template.statements(`\n    \"use strict\";\n    ${\n      Object.entries(bindings).map(([key, value]) => `const ${value} = _${key};`).join('\\n')\n    }\n    return (async () => {\n      BODY\n    })();\n  `, {\n    placeholderPattern: /^BODY$/\n  });\n\n  const checkedForWrap = Symbol('checkedForWrap');\n  return {\n    visitor: {\n      Program(path) {\n        path.node.body = iife({ BODY: path.node.body });\n      },\n\n      // Wrap all Objects with a Proxy at runtime.\n      Expression(path) {\n        if (!path.node.loc) return;\n        if (path.node[checkedForWrap]) return;\n        path.node[checkedForWrap] = true;\n\n        // Don't wrap types that either aren't Objects or are guaranteed\n        // to already be wrapped (e.g. ParenthesizedExpression).\n        if (NO_WRAP_NEEDED.has(path.node.type)) return;\n\n        // Don't wrap lvalues.\n        if (path.parentPath.isAssignmentExpression({ left: path.node }) ||\n            path.parentPath.isUnaryExpression({ operator: 'delete' }) ||\n            path.parentPath.isUpdateExpression()) {\n          return;\n        }\n\n        // Don't bother wrapping an expression whose value is discarded.\n        if (path.parentPath.isExpressionStatement({ expression: path.node })) return;\n\n        path.replaceWith(wrap({ NODE: path.node }));\n      },\n\n      // Use helper function for method calls.\n      CallExpression(path) {\n        if (!path.node.loc) return;\n\n        if (path.get('callee').isMemberExpression()) {\n          const callee = path.node.callee;\n          path.replaceWith(call({\n            OBJECT: callee.object,\n            PROPERTY: callee.computed ? callee.property : `'${callee.property.name}'`,\n            ARGS: path.node.arguments\n          }));\n        }\n      }\n    }\n  }\n}\n\nexport class Transpiler {\n  babel = Babel;\n  babelOptions = {\n    parserOpts: {\n      strictMode: true,\n      allowReturnOutsideFunction: true\n    },\n    plugins: ['syntax-top-level-await'],\n    sourceMaps: true\n  };\n\n  /**\n   * @param {{ bindings?: object }} [options] \n   */\n  constructor(options = {}) {\n    // @ts-ignore\n    this.babelOptions.plugins.push(['proxy-script', options]);\n  }\n\n  /**\n   * @param {string} source \n   * @returns {object}\n   */\n  transpile(source) {\n    return this.babel.transform(source, this.babelOptions);\n  }\n};\n\nTranspiler.register = function(babel) {\n  Babel = babel;\n  babel.registerPlugin('proxy-script', plugin);\n}\n\nfunction createRandomString() {\n  return Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(36);\n}","// Make sure some definitions exist.\n// @ts-ignore\nconst btoa = globalThis.btoa ?? (s => Buffer.from(s).toString('base64'));\nconst AsyncFunction = (async () => {}).constructor;\n\n// Enumerate global objects and their properties.\nconst GLOBALS = new WeakSet();\ngetGlobals(globalThis);\n\n// The AsyncFunction constructor is *not* a global object but\n// it needs to be marked as global to prevent mutation.\ngetGlobals(AsyncFunction);\n\nfunction getGlobals(obj, key) {\n  if (obj === Object(obj) && !GLOBALS.has(obj)) {\n    GLOBALS.add(obj);\n    const descriptors = Object.getOwnPropertyDescriptors(obj);\n    for (const [name, descriptor] of Object.entries(descriptors)) {\n      try {\n        // Skip prototype getters, which may fail and generally don't\n        // return persistent objects anyway.\n        if (key !== 'prototype' || !descriptor.get) {\n          getGlobals(obj[name], name);\n        }\n      } catch (e) {\n        // @ts-ignore\n        if (typeof process === 'undefined') {\n          // These messages are suppressed outside the browser environment.\n          console.warn('global enumeration failure', name);\n        }\n      }\n    }\n  }\n}\n\n// Determine number of lines inserted by Function constructor. We need\n// this information to patch the sourcemap for browser Dev Tools, and\n// it varies with the Javascript implementation.\nconst SOURCEMAP_OFFSET = (function() {\n  const lines = new Function('debugger').toString().split('\\n');\n  return lines.findIndex(line => line.includes('debugger'));\n})();\n\n// Transpiler output is post-processed so its sourcemaps work properly.\n// Post-processed output is tagged with this Symbol.\nconst PREPARED = Symbol('prepared');\n\nexport class Runtime {\n  /**\n   * Whitelist functions can be called. Note that non-whitelist objects\n   * (that are not on the blacklist) allow access to properties.\n   * @type {Set<function|object>}\n   */\n  whitelist = new Set([\n    [\n      Array, Object, Boolean, Error,\n      Number, BigInt, Date,\n      String, RegExp,\n      Map, Set, WeakMap, WeakSet,\n      Symbol,\n      Promise,\n\n      ArrayBuffer,\n      Int8Array, Int16Array, Int32Array,\n      Uint8Array, Uint16Array, Uint32Array,\n      Float32Array, Float64Array,\n      DataView\n    ].map(cls => getClassEntries(cls)).flat(),\n\n    // Don't include Function constructor or toString().\n    Function.prototype.call,\n    Function.prototype.apply,\n    Function.prototype.bind,\n\n    getOwnProperties(console),\n    getOwnProperties(Math),\n    getOwnProperties(JSON),\n\n    globalThis.atob, globalThis.btoa,\n    globalThis.isFinite, globalThis.isNaN,\n    globalThis.parseFloat, globalThis.parseInt,\n    globalThis.encodeURI, globalThis.encodeURIComponent,\n    globalThis.decodeURI, globalThis.decodeURIComponent\n  ].flat().filter(x => x === Object(x)));\n\n  /**\n   * Blacklist objects cannot be used at all.\n   * @type {Set<function|object>}\n   */\n  blacklist = new Set([\n    globalThis.document\n  ].filter(x => x === Object(x)));\n\n  // All proxies are remembered in this map. This is not just an optimization;\n  // it is important that the same proxy is always used for the same object.\n  // Consider the case where objects are kept in a set and tested for\n  // membership - that doesn't work if there can be multiple proxies.\n  //\n  // Proxies are mapped to themselves. Hopefully that doesn't affect garbage\n  // collection.\n  mapObjectToProxy = new WeakMap();\n\n  /** @type {ProxyHandler} */\n  handler = {\n    apply: (target, thisArg, args) => {\n      this.assertAccess(target, 'apply');\n      return Reflect.apply(target, thisArg, args);\n    },\n\n    construct: (target, args, newTarget) => {\n      this.assertAccess(target, 'construct');\n      // https://stackoverflow.com/a/49739161/1462337\n      return Reflect.construct(target, args, newTarget);\n    },\n\n    get: (target, property) => {\n      const member = Reflect.get(target, property);\n      if (member === Object(member)) {\n        // This member object has been reached via a global so it is also\n        // marked as a global. This is needed to wrap objects reached via\n        // getters, notably DOM objects.\n        GLOBALS.add(member);\n      }\n      return member;\n    },\n\n    defineProperty() { throw new Error('proxy-script defineProperty violation'); },\n    deleteProperty() { throw new Error('proxy-script deleteProperty violation'); },\n    preventExtensions() { throw new Error('proxy-script preventExtensions violation'); },\n    set() { throw new Error('proxy-script set violation'); },\n    setPrototypeOf() { throw new Error('proxy-script setPrototypeOf violation'); },\n  };\n  \n  /**\n   * Runtime Proxy wrapper.\n   * @param {object} obj \n   * @returns {any} Proxy for a global, otherwise the argument itself.\n   */\n  maybeWrap(obj) {\n    if (obj !== Object(obj)) return obj;\n    if (this.blacklist.has(obj)) throw new Error('proxy-script blacklist violation');\n    if (!GLOBALS.has(obj)) return obj;\n\n    if (this.mapObjectToProxy.has(obj)) {\n      // This object already has a Proxy so use the existing one.\n      return this.mapObjectToProxy.get(obj);\n    }\n\n    const proxy = new Proxy(obj, this.handler);\n    this.mapObjectToProxy.set(obj, proxy);\n    this.mapObjectToProxy.set(proxy, proxy);\n    return proxy;\n  }\n  \n  /**\n   * Runtime support for method invocation.\n   * @param {*} object \n   * @param {*} property \n   * @param  {...any} args \n   */\n  call(object, property, ...args) {\n    return this.maybeWrap(object[property]).apply(object, args);\n  }\n\n  assertAccess(obj, type = 'access') {\n    if (GLOBALS.has(obj) && !this.whitelist.has(obj)) {\n      throw new Error(`proxy-script ${type} violation`);\n    }\n  }\n\n  /**\n   * @param {{code: string, map?: object}} transpiled \n   */\n  prepare(transpiled) {\n    if (transpiled[PREPARED]) return transpiled;\n\n    // Add an inline sourcemap if possible.\n    let code = transpiled.code;\n    const map = transpiled.map && Object.assign({}, transpiled.map);\n    if (map && map.version === 3) {\n      // Patch sourcemap for insertions by Function constructor.\n      // We only need to prepend a semicolon to `mappings` for each line\n      // of code added at the start.\n      // https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit\n      map.mappings = new Array(SOURCEMAP_OFFSET).fill(';').join('') + map.mappings;\n\n      // Add the sourcemap inline to the code.\n      const json = JSON.stringify(map);\n      const url = `data:application/json;charset=utf-8;base64,${btoa(json)}`;\n      if (url.length < 2 ** 23) {\n        code += `\\n//# sourceMappingURL=${url}`;\n      } else {\n        console.warn(`proxy-script sourcemap omitted due to size (${url.length} bytes)`);\n      }\n    }\n    return { code, map, [PREPARED]: true };\n  }\n\n  /**\n   * @param {{code: string, map?: object}} transpiled \n   * @param {object?} [thisArg]\n   * @param {object} [args] \n   */\n  async runPrepared(transpiled, thisArg, args = {}) {\n    console.assert(transpiled[PREPARED], 'running unprepared code');\n    this.whitelist.add = () => {\n      throw new Error('whitelist modification after run');\n    };\n    this.blacklist.add(Function);\n    this.blacklist.add(AsyncFunction);\n    this.blacklist.add(eval);\n\n    args = Object.assign({}, args, {\n      '_wrap': this.maybeWrap.bind(this),\n      '_call': this.call.bind(this)\n    });\n    const f = new Function(...Object.keys(args), transpiled.code);\n    return await f.call(thisArg, ...Object.values(args));\n  }\n\n  /**\n   * @param {{code: string, map?: object}} transpiled \n   * @param {object?} thisArg\n   * @param {object} args \n   * @returns {Promise}\n   */\n  run(transpiled, thisArg, args) {\n    if (!transpiled[PREPARED]) {\n      transpiled = this.prepare(transpiled);\n    }\n    return this.runPrepared(transpiled, thisArg, args);\n  }\n};\n\nRuntime.Error = class extends Error {\n  constructor(message, { line, column }) {\n    super(`${message} (${line}:${column})`);\n    this.line = line;\n    this.column = column;\n  }\n};\n\n/**\n * Update collection of global objects in case of additions to the\n * global scope after module load.\n */\nRuntime.updateGlobals = () => {\n  getGlobals(globalThis);\n}\n\n/**\n * Given a class, returns array of related items (including the class).\n * @param {function} cls \n */\nfunction getClassEntries(cls) {\n  return [cls, getOwnProperties(cls), getOwnProperties(cls.prototype)].flat();\n}\n\n/**\n * Given an object, returns array of property values.\n * @param {object} obj \n */\nfunction getOwnProperties(obj) {\n  return Object.getOwnPropertyNames(obj).filter(name => {\n    const descriptor = Object.getOwnPropertyDescriptor(obj, name);\n    return !descriptor.get;\n  }).map(name => obj[name]);\n}\n"],"names":[],"mappings":"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"}